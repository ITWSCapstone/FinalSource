library(shiny)
library(shinydashboard)
library(shinyBS)
library(shinyjs)
library(ggplot2)
library(reshape2)
library(dygraphs)
library(xts)
library(party)
library(DT)
theme_set(theme_bw())
   
source("functions.R",local=TRUE)
dbHeader<-dashboardHeader(titleWidth = 350)
dbHeader$children[[2]]$children <- div(tags$img(src='jjlogo.png',height='60',width='310'))
dbHeader$children[[3]]$children <- div(id="buttons",actionButton("aboutLink", "About Us", icon=icon("user")), actionButton("guideLink", "Guide", icon=icon("book")))
dashboardPage(skin="red", 
  dbHeader,
  dashboardSidebar(
      tags$head(
        tags$link(rel = "stylesheet", type = "text/css", href = "styling.css") #styling from external stylesheet
      ),
      sidebarMenu(id = "sidebarmenu",
        menuItem("Input Data", icon = icon("download"),
        menuSubItem(icon=NULL,fileInput('file1', 'Choose CSV File',accept=c('text/csv', 'text/comma-separated-values,text/plain', '.csv'))),
        menuSubItem(icon=NULL,checkboxInput('header', 'Header', TRUE)),
        menuSubItem(icon=NULL,radioButtons('sep', 'Separator',c(Comma=',',Semicolon=';',Tab='\t'),'Comma')),
        menuSubItem(icon=NULL,radioButtons('quote', 'Quote',c(None='','Double Quote'='"','Single Quote'="'"),'Double Quote'))
        ),
        menuItem("Visualization Filters", tabName = "visualFilters", icon = icon("bar-chart")),
        conditionalPanel("input.sidebarmenu ==='visualFilters'",
            uiOutput("vis"),
            uiOutput("groupcol")
        )
    )
  ),
  dashboardBody(
    useShinyjs(),
    bsModal("aboutPage", title=NULL, "aboutLink", size = "large", ######POP UP FOR ABOUT PAGE
    h1("About Us", align = "center", id = "About"),
    h4("About Forecasting Analytics", align = "left", class = "aboutques"),
    p("Our mission for this project is to create an efficient, automated and interactive interface which will allow stakeholders to upload their data in a specified format and output the appropriate forecasting method along with data visualization. 
      The application will educate end-users on forecasting techniques to help format data, choose appropriate models, and ultimately allow Johnson & Johnson to make better data-driven decisions."),
    h4("Purpose of Forecasting Analytics", align = "left", class = "aboutques"),
    p("Johnson & Johnson guides their decision making through values spelled out in The Credo. The Credo challenges Johnson & Johnson to put the needs and well-being of the people they serve first. This project helps to serve the employees and ultimately the doctors, nurses and patients, mothers and fathers, and any others who use Johnson & Johnson’s products and services. 
      Through building this company-wide forecasting application, employees will be able to effectively analyze data to better serve the interests of Johnson & Johnson’s customers. "),
    h4("First-time Users", align = "left", class = "aboutques"),
    p("You are able to play around with the data until you feel comfortable to use your original data. You can follow step by step tutorials in the guide section for assitance.
      Please contact ---- for further questions"),
   img(src="jnjaslogo.png", height = 100, align = "center")
    ),
    bsModal("guidePage", title=NULL, "guideLink", size = "large", ######POP UP FOR GUIDE PAGE
      h1("Step-by-Step Guide",align = "center", id = "Guide"),
      fluidRow(
        div(id="steps",align="center",
          HTML('<figure>'),img(src="Step1.png"),
          HTML('<figcaption>Input Data<p>Choose a file by selecting "Input Data" tab.</p> 
               <p>Make sure you file is in CSV. or Excel format</p></figcaption></figure><figure>'),img(src="Step2.png"),
          HTML('<figcaption>Model and Visualize Data<p> View different models and visualization from the uploaded data</p>
               <p>Use different filters and modeling variables to view better results</p></figcaption></figure><figure>'),img(src="Step3.png"),
          HTML('<figcaption>Download Results<p>Download analytics results from the "Download" button</figcaption></figure><figure>')
        )
      )
    ),
    fluidRow(
      HTML("<div class='tabs'>"),
      tabBox(id="tabs", width=12,
        tabPanel("Visualize",
          carouselPanel(
            box(title="Boxplot", div(class="info-icon", id="boxplot-info", icon("info-circle")), width=12,solidHeader=TRUE, plotOutput("boxplot")),
            box(title="Densityplot", div(class="info-icon", id="densityplot-info", icon("info-circle")), width=12,solidHeader=TRUE,plotOutput("densityplot",dblclick = "plotdblclick",brush = brushOpts(id = "brush",resetOnNew = TRUE))),
            box(title="Scatterplot", div(class="info-icon", id="scatterplot-info", icon("info-circle")), width=12,solidHeader=TRUE,div(style="clear:both; padding-right:8px; width: 25%;",uiOutput("timecol")),plotOutput("scatterplot")),
            auto.advance=FALSE 
          )
        ),
        tabPanel("Model",
          carouselPanel(
            box(id="model1_box",title="K Means Clustering", div(class="info-icon", id="kmeans-info", icon("info-circle")), width=12,solidHeader = TRUE,
              div(class="control-row", style="width: 100%; clear: both;", 
                div(style="float: left; padding-right:8px; width: 25%;",uiOutput("clust_dep")),
                div(style="float: left; padding-right:8px; width: 25%;",uiOutput("clust_indep")),
                div(style="float: left; padding-right:8px; width: 25%;",numericInput('clusters', 'Cluster count', 3,min = 1, max = 9))
              ), 
              plotOutput('model1'),
              hidden(
                div(id="model1_i",
                    box( title="More Information",width=12,
                         verbatimTextOutput("model1_info")   
                    )
                )
              )
            ),
            box(id="model2_box",title="Bivariate Linear Regression", div(class="info-icon", id="bivariate-info", icon("info-circle")), width=12,solidHeader = TRUE,
              div(class="control-row", style="width: 100%; clear: both;",
                div(style="display:inline-block; padding-right:8px;",uiOutput("lm_dep")),
                div(style="display:inline-block; padding-right:8px;",uiOutput("lm_indep"))
              ), 
              plotOutput('model2'),
              hidden(
                div(id="model2_i",
                  box( title="More Information", width=7,
                    verbatimTextOutput("model2_info")   
                  ),
                  box( title="Residuals",width=5,
                    plotOutput("model2_resid") 
                  )
                )
              )
            ),   

<<<<<<< Updated upstream
            box(id="model3_box",title="Decision Tree",width=12,solidHeader = TRUE,
                div(style="display:inline-block; padding-right:8px;",uiOutput("tree_dep")),
                div(style="display:inline-block; padding-right:8px;",uiOutput("tree_indep")),
                plotOutput('model3'),
                hidden(
                  div(id="model3_i",
                      box( title="More Information", width=12,
                           verbatimTextOutput("model3_info")   
                      )
                  )
                )
            ),
                      
            box(id="model4_box",title="ARIMA",width=12,solidHeader = TRUE,
                div(style="display:inline-block; padding-right:8px;",uiOutput("arima_dep")),
                div(style="display:inline-block; padding-right:8px;",uiOutput("arima_indep")),
                div(style="display:inline-block; padding-right:8px;",uiOutput("timecol2")),
=======
            box(id="model3_box",title="Decision Tree", div(class="info-icon", id="decisiontree-info", icon("info-circle")), width=12,solidHeader = TRUE,
                div(class="control-row", style="width: 100%; clear: both;",
                  div(style="display:inline-block; padding-right:8px;",uiOutput("tree_dep")),
                  div(style="display:inline-block; padding-right:8px;",uiOutput("tree_indep"))
                ), 
                plotOutput('model3')
            ),
            box(id="model4_box",title="ARIMA", div(class="info-icon", id="arima-info", icon("info-circle")), width=12,solidHeader = TRUE,
                div(class="control-row", style="width: 100%; clear: both;", 
                  div(style="display:inline-block; padding-right:8px;",uiOutput("arima_dep")),
                  div(style="display:inline-block; padding-right:8px;",uiOutput("arima_indep")),
                  div(style="display:inline-block; padding-right:8px;",uiOutput("timecol2"))
                ),
>>>>>>> Stashed changes
                plotOutput('model4'),
                hidden(
                  verbatimTextOutput("model4_info")
                )
            ),
            auto.advance=FALSE
          )
        )
      ),
      HTML("</div>")
    ),
    div(style="display:inline-block",selectInput("plots", "Choose Plot(s)", choices=list("Boxplot","Density Plot","Scatter Plot","K-Means","Linear Model","Decision Tree","ARIMA"), multiple=TRUE)),
    div(style="display:inline-block;",downloadButton('downloadPlots')),
    bsCollapsePanel("View Data",bsCollapsePanel("Summary",verbatimTextOutput("summary")), DT::dataTableOutput('mydata'))
  )
)